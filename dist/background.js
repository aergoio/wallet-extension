!function(t){function e(e){for(var r,c,i=e[0],u=e[1],s=e[2],f=0,p=[];f<i.length;f++)c=i[f],o[c]&&p.push(o[c][0]),o[c]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);for(l&&l(e);p.length;)p.shift()();return a.push.apply(a,s||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],r=!0,i=1;i<n.length;i++){var u=n[i];0!==o[u]&&(r=!1)}r&&(a.splice(e--,1),t=c(c.s=n[0]))}return t}var r={},o={1:0},a=[];function c(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=t,c.c=r,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)c.d(n,r,function(e){return t[e]}.bind(null,r));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="";var i=window.webpackJsonp=window.webpackJsonp||[],u=i.push.bind(i);i.push=e,i=i.slice();for(var s=0;s<i.length;s++)e(i[s]);var l=u;a.push([208,0]),n()}({104:function(t,e){},208:function(t,e,n){"use strict";n.r(e);n(63);var r=n(13),o=n.n(r),a=n(61),c=n.n(a),i=n(51),u=n.n(i),s=n(9),l=n(83),f=n.n(l),p=n(52),h=n.n(p),v=n(8),y=n(2),d=n(53);function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var x=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=g(this,k(e).call(this)))._idleTimeout=null,t.set("initial"),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(e,s["EventEmitter"]),function(t,e,n){e&&b(t.prototype,e),n&&b(t,n)}(e,[{key:"set",value:function(t){var e=this;"inactive"!=t&&this._idleTimeout&&clearTimeout(this._idleTimeout),this.state!=t&&"inactive"==t&&(this._idleTimeout&&clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(function(){e.set("idle")},6e4)),this.state!=t&&console.log("[state] ".concat(this.state," -> ").concat(t)),this.state=t,this.emit("change",t),this.emit(t)}}]),e}(),O=(n(59),n(5));function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function P(t,e,n,r,o,a,c){try{var i=t[a](c),u=i.value}catch(t){return void n(t)}i.done?e(u):Promise.resolve(u).then(r,o)}function S(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function c(t){P(a,r,o,c,i,"next",t)}function i(t){P(a,r,o,c,i,"throw",t)}c(void 0)})}}function R(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _(t,e){return!e||"object"!==j(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t,e){return(A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var E=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=_(this,T(e).call(this))).intervals={},n.store=t,n.lastBlockPromise={},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&A(t,e)}(e,s["EventEmitter"]),function(t,e,n){e&&R(t.prototype,e),n&&R(t,n)}(e,[{key:"_getTransactionsSince",value:function(){var t=S(regeneratorRuntime.mark(function t(e,n){var r,o,a,c,i,u,s=arguments;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:100,o=s.length>3&&void 0!==s[3]?s[3]:0,console.log("Getting txs for ".concat(e.id," since ").concat(n,"...")),a=encodeURIComponent("(from:".concat(e.id," OR to:").concat(e.id,") AND blockno:>").concat(n)),c=Object(O.b)(e.data.chain).apiUrl("/transactions?q=".concat(a,"&sort=blockno:desc&size=").concat(r,"&from=").concat(o)),t.next=7,fetch(c);case 7:return i=t.sent,t.next=10,i.json();case 10:return u=t.sent,console.log("Got ".concat(u.hits.length," (of ").concat(u.total,") txs for ").concat(e.id," since ").concat(n,".")),t.abrupt("return",u.hits);case 13:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()},{key:"_getBestBlock",value:function(){var t=S(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.lastBlockPromise[e.data.chain]){t.next=4;break}return t.next=3,this.lastBlockPromise[e.data.chain];case 3:return t.abrupt("return",t.sent);case 4:return this.lastBlockPromise[e.data.chain]=new Promise(function(){var t=S(regeneratorRuntime.mark(function t(n){var r,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object(O.b)(e.data.chain).apiUrl("/bestBlock"),t.next=3,fetch(r);case 3:return o=t.sent,t.next=6,o.json();case 6:a=t.sent,n(a);case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()),t.next=7,this.lastBlockPromise[e.data.chain];case 7:return n=t.sent,this.lastBlockPromise[e.data.chain]=null,t.abrupt("return",n);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"trackAccount",value:function(t){var e=this;void 0!==this.intervals[t.id]&&null!==this.intervals[t.id]&&this.stopTrackingAccount(t);var n=!1,r=function(){var r=S(regeneratorRuntime.mark(function r(){var o,a,c,i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.store.open();case 2:o=0;try{o=t.data.lastSync.blockno}catch(t){}return r.next=6,e._getTransactionsSince(t,o);case 6:return a=r.sent,r.next=9,Promise.all(a.map(function(t){return e.store.transactions.put(t.hash,t.meta)}));case 9:return r.next=11,e._getBestBlock(t);case 11:if(c=r.sent,t.data.lastSync={blockno:c.meta.no,time:c.meta.ts},!(a.length>0)&&n){r.next=19;break}return r.next=16,Object(O.b)(t.data.chain).nodeClient().getState(t.id);case 16:i=r.sent,t.data.balance=i.balance.toString(),n=!0;case 19:return console.log("[".concat(t.id,"] Saved ").concat(a.length," new txs, balance is ").concat(t.data.balance,".")),r.next=22,e.store.accounts.put(t.id,t.data);case 22:case"end":return r.stop()}},r,this)}));return function(){return r.apply(this,arguments)}}();this.intervals[t.id]=setInterval(r,15e3),r()}},{key:"stopTrackingAccount",value:function(t){clearInterval(this.intervals[t.id]),this.intervals[t.id]=null}}]),e}();function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function U(t,e,n,r,o,a,c){try{var i=t[a](c),u=i.value}catch(t){return void n(t)}i.done?e(u):Promise.resolve(u).then(r,o)}function C(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function c(t){U(a,r,o,c,i,"next",t)}function i(t){U(a,r,o,c,i,"throw",t)}c(void 0)})}}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function M(t,e){return!e||"object"!==K(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function D(t){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function F(t,e){return(F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var G=function(t){function e(t,n,r){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=M(this,D(e).call(this))).intervals={},o.store=t,o.state=n,o.transactionManager=r,o.accounts=[],o.accountsById={},o.trackedAccounts=[],o.initialLoad=!1,o.state.on("active",function(){console.log("became active"),o.startTracking()}),o.state.on("idle",function(){console.log("became idle"),o.stopTracking()}),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(e,s["EventEmitter"]),function(t,e,n){e&&I(t.prototype,e),n&&I(t,n)}(e,[{key:"loadFromStore",value:function(){var t=C(regeneratorRuntime.mark(function t(){var e,n,r,o,a,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.open();case 2:return t.next=4,this.store.accounts.getAll();case 4:for(this.accounts=t.sent,e=!0,n=!1,r=void 0,t.prev=8,o=this.accounts[Symbol.iterator]();!(e=(a=o.next()).done);e=!0)c=a.value,this.accountsById[c.id]=c;t.next=16;break;case 12:t.prev=12,t.t0=t.catch(8),n=!0,r=t.t0;case 16:t.prev=16,t.prev=17,e||null==o.return||o.return();case 19:if(t.prev=19,!n){t.next=22;break}throw r;case 22:return t.finish(19);case 23:return t.finish(16);case 24:case"end":return t.stop()}},t,this,[[8,12,16,24],[17,,19,23]])}));return function(){return t.apply(this,arguments)}}()},{key:"startTracking",value:function(){var t=C(regeneratorRuntime.mark(function t(){var e,n,r,o,a,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadFromStore();case 2:for(this.initialLoad=!0,e=!0,n=!1,r=void 0,t.prev=6,o=this.accounts[Symbol.iterator]();!(e=(a=o.next()).done);e=!0)c=a.value,this.transactionManager.trackAccount(c);t.next=14;break;case 10:t.prev=10,t.t0=t.catch(6),n=!0,r=t.t0;case 14:t.prev=14,t.prev=15,e||null==o.return||o.return();case 17:if(t.prev=17,!n){t.next=20;break}throw r;case 20:return t.finish(17);case 21:return t.finish(14);case 22:this.trackedAccounts=B(this.accounts),console.log("Tracking ".concat(this.trackedAccounts.length," accounts"));case 24:case"end":return t.stop()}},t,this,[[6,10,14,22],[15,,17,21]])}));return function(){return t.apply(this,arguments)}}()},{key:"stopTracking",value:function(){var t=C(regeneratorRuntime.mark(function t(){var e,n,r,o,a,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=!0,n=!1,r=void 0,t.prev=3,o=this.trackedAccounts[Symbol.iterator]();!(e=(a=o.next()).done);e=!0)c=a.value,this.transactionManager.stopTrackingAccount(c);t.next=11;break;case 7:t.prev=7,t.t0=t.catch(3),n=!0,r=t.t0;case 11:t.prev=11,t.prev=12,e||null==o.return||o.return();case 14:if(t.prev=14,!n){t.next=17;break}throw r;case 17:return t.finish(14);case 18:return t.finish(11);case 19:case"end":return t.stop()}},t,this,[[3,7,11,19],[12,,14,18]])}));return function(){return t.apply(this,arguments)}}()}]),e}(),L=n(21),z=n.n(L),H=n(7);function J(t){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e,n,r,o,a,c){try{var i=t[a](c),u=i.value}catch(t){return void n(t)}i.done?e(u):Promise.resolve(u).then(r,o)}function q(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function c(t){N(a,r,o,c,i,"next",t)}function i(t){N(a,r,o,c,i,"throw",t)}c(void 0)})}}function W(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Q(t,e){return!e||"object"!==J(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function V(t){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function X(t,e){return(X=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Y(t){return z.a.encode(H.Buffer.from(t))}var Z=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Q(this,V(e).call(this))).id=o.a.runtime.id,t.uiState={popupOpen:!1},t.aergo=Object(O.b)(O.a).nodeClient(),t.store=new d.a,t.transactionManager=new E(t.store),t.state=new x,t._lockTimeout=null,t.lock(),t.accountManager=new G(t.store,t.state,t.transactionManager),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&X(t,e)}(e,s["EventEmitter"]),function(t,e,n){e&&W(t.prototype,e),n&&W(t,n)}(e,[{key:"unlock",value:function(){var t=q(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.open();case 2:return t.next=4,this.store.settings.get("encryptedId");case 4:return n=t.sent,t.prev=5,t.next=8,Object(y.decryptPrivateKey)(n.data,e);case 8:t.sent,t.next=14;break;case 11:throw t.prev=11,t.t0=t.catch(5),new Error("invalid passphrase");case 14:this.masterPassword=e,this.unlocked=!0,this.emit("update",{unlocked:!0}),this.keepUnlocked(),console.log("[lock] unlocked");case 19:case"end":return t.stop()}},t,this,[[5,11]])}));return function(e){return t.apply(this,arguments)}}()},{key:"setupAndUnlock",value:function(){var t=q(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.open();case 2:return t.next=4,Object(y.encryptPrivateKey)(H.Buffer.from(this.id),e);case 4:return n=t.sent,t.next=7,this.store.settings.put("encryptedId",n);case 7:return t.next=9,this.store.settings.put("initialized",!0);case 9:return t.next=11,this.unlock(e);case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"keepUnlocked",value:function(){var t=this;this._lockTimeout&&clearTimeout(this._lockTimeout),this._lockTimeout=setTimeout(function(){console.log("[lock] auto-locking..."),t.lock()},6e4)}},{key:"lock",value:function(){this.masterPassword="",this.unlocked=!1,this.emit("update",{unlocked:!1}),console.log("[lock] locked")}},{key:"isUiOpen",value:function(){return this.uiState.popupOpen}},{key:"setupCommunication",value:function(t){var e=this,n=h()({unlock:function(){var t=q(regeneratorRuntime.mark(function t(n,r){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.password,t.prev=1,t.next=4,e.unlock(o);case 4:t.next=11;break;case 6:return t.prev=6,t.t0=t.catch(1),console.error(t.t0),r({error:""+t.t0}),t.abrupt("return");case 11:r({});case 12:case"end":return t.stop()}},t,this,[[1,6]])}));return function(e,n){return t.apply(this,arguments)}}(),lock:function(){var t=q(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.lock(),n({});case 2:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),setup:function(){var t=q(regeneratorRuntime.mark(function t(n,r){var o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.password,t.next=3,e.setupAndUnlock(o);case 3:r({});case 4:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),isUnlocked:function(){var t=q(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n(e.unlocked);case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),reset:function(){var t=q(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.store.open();case 2:return t.next=4,e.store.accounts.clear();case 4:return t.next=6,e.store.transactions.clear();case 6:return t.next=8,e.store.settings.clear();case 8:n();case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),getBlockchainStatus:function(){var t=q(regeneratorRuntime.mark(function t(n){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.aergo.blockchain();case 2:r=t.sent,n({blockHeight:r.bestHeight,chainId:O.a});case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),getAccounts:function(){var t=q(regeneratorRuntime.mark(function t(n){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.keepUnlocked(),t.next=3,e.store.open();case 3:return t.next=5,e.store.accounts.getAll();case 5:r=t.sent,n(r);case 7:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),createAccount:function(){var t=q(regeneratorRuntime.mark(function t(n,r){var o,a,c,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.name,e.keepUnlocked(),a=O.a,t.next=5,Object(y.createIdentity)();case 5:return c=t.sent,i=c.address,t.next=9,e.store.open();case 9:return t.t0=e.store.accounts,t.t1=i,t.t2=c.publicKey.encodeCompressed(),t.next=14,Object(y.encryptPrivateKey)(H.Buffer.from(c.privateKey.toArray()),e.masterPassword);case 14:return t.t3=t.sent,t.t4=a,t.t5=o,t.t6={balance:"0 aer",publicKey:t.t2,privateKey:t.t3,chain:t.t4,name:t.t5},t.next=20,t.t0.put.call(t.t0,t.t1,t.t6);case 20:e.accountManager.startTracking(),r({address:i});case 22:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),importAccount:function(){var t=q(regeneratorRuntime.mark(function t(n,r){var o,a,c,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.privateKey,e.keepUnlocked(),a=O.a,c=Object(y.identifyFromPrivateKey)(o),i=c.address,t.next=7,e.store.open();case 7:return t.t0=e.store.accounts,t.t1=i,t.t2=c.publicKey.encodeCompressed(),t.next=12,Object(y.encryptPrivateKey)(H.Buffer.from(c.privateKey.toArray()),e.masterPassword);case 12:return t.t3=t.sent,t.t4=a,t.t5=name,t.t6={balance:"0 aer",publicKey:t.t2,privateKey:t.t3,chain:t.t4,name:t.t5},t.next=18,t.t0.put.call(t.t0,t.t1,t.t6);case 18:e.accountManager.startTracking(),r({address:i});case 20:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),exportAccount:function(){var t=q(regeneratorRuntime.mark(function t(n,r){var o,a,c,i,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.id,a=n.password,e.keepUnlocked(),t.next=4,e.store.accounts.get(o);case 4:return c=t.sent,t.prev=5,t.next=8,Object(y.decryptPrivateKey)(c.data.privateKey,e.masterPassword);case 8:i=t.sent,t.next=16;break;case 11:return t.prev=11,t.t0=t.catch(5),console.error(t.t0),r({error:"Could not decrypt private key. "+t.t0}),t.abrupt("return");case 16:return t.next=18,Object(y.encryptPrivateKey)(i,a);case 18:u=t.sent,r({privateKey:Object(y.encodePrivateKey)(u)});case 20:case"end":return t.stop()}},t,this,[[5,11]])}));return function(e,n){return t.apply(this,arguments)}}(),sendTransaction:function(){var t=q(regeneratorRuntime.mark(function t(n,r){var o,a,c,i,u,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.keepUnlocked(),t.next=3,e.store.open();case 3:return t.next=5,e.store.accounts.get(n.from);case 5:return o=t.sent,t.prev=6,t.next=9,Object(y.decryptPrivateKey)(o.data.privateKey,e.masterPassword);case 9:a=t.sent,t.next=17;break;case 12:return t.prev=12,t.t0=t.catch(6),console.error(t.t0),r({error:"Could not decrypt private key. "+t.t0}),t.abrupt("return");case 17:return c=Object(y.identifyFromPrivateKey)(a),i=new v.Amount(n.amount).toUnit("aer"),t.next=21,e.aergo.getNonce(n.from);case 21:return t.t1=t.sent,n.nonce=1+t.t1,n.amount=i.value.toString(),t.next=26,Object(y.signTransaction)(n,c.keyPair);case 26:return n.sign=t.sent,t.next=29,Object(y.hashTransaction)(n,"bytes");case 29:return n.hash=t.sent,n.amount=i.toString(),console.log(n),u=Y(n.hash),t.prev=33,t.next=36,e.aergo.sendSignedTransaction(n);case 36:return n.hash=u,s={ts:(new Date).toISOString(),blockno:null,from:n.from,to:n.to,amount:n.amount,type:n.type,status:"pending"},n.payload.length&&(s.payload0=""+n.payload[0]),t.next=41,e.store.transactions.put(u,s);case 41:r({tx:n}),t.next=48;break;case 44:t.prev=44,t.t2=t.catch(33),console.error(t.t2),r({error:""+t.t2});case 48:case"end":return t.stop()}},t,this,[[6,12],[33,44]])}));return function(e,n){return t.apply(this,arguments)}}(),getAccountTx:function(){var t=q(regeneratorRuntime.mark(function t(n,r){var o,a,c,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.store.open();case 2:return o=IDBKeyRange.bound(n,n),t.next=5,e.store.transactions.getAllIndex("from",o);case 5:return a=t.sent,t.next=8,e.store.transactions.getAllIndex("to",o);case 8:c=t.sent,(i=a.concat(c).filter(function(t){return!this.has(t.hash)&&this.add(t.hash)},new Set)).sort(function(t,e){return t.data.ts<e.data.ts?1:t.data.ts==e.data.ts?0:-1}),r(i);case 12:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),syncAccountState:function(){var t=q(regeneratorRuntime.mark(function t(n,r){var o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.store.open();case 2:return t.next=4,e.store.accounts.get(n);case 4:return o=t.sent,t.next=7,e.aergo.getState(n);case 7:a=t.sent,console.log("got new state",n,a),o.data.balance=a.balance.toString(),e.store.accounts.put(n,o.data),r(o);case 12:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()});f()(t,n,t,function(t){t&&log.error(t)}),n.on("remote",function(t){var n=t.sendUpdate.bind(t);e.on("update",n)}),this.state.on("change",function(t){e.emit("update",{state:t})})}}]),e}();function $(t,e,n,r,o,a,c){try{var i=t[a](c),u=i.value}catch(t){return void n(t)}i.done?e(u):Promise.resolve(u).then(r,o)}function tt(){return(tt=function(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function c(t){$(a,r,o,c,i,"next",t)}function i(t){$(a,r,o,c,i,"throw",t)}c(void 0)})}}(regeneratorRuntime.mark(function t(){var e,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=function(t){var n=t.name;console.log("Establishing connection with",n),e.state.set("active");var r=new u.a(t);e.setupCommunication(r),e.uiState.popupOpen=!0,c()(r,function(){e.uiState.popupOpen=!1,console.log("Closed connection with",n),e.state.set("inactive")})},e=new Z,o.a.runtime.onConnect.addListener(n);case 3:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}n(91),console.log("AERGO Wallet Background Script"),console.log("Extension ID",o.a.runtime.id),function(){tt.apply(this,arguments)}(),chrome.contextMenus.removeAll(),chrome.contextMenus.create({title:"Open full page",contexts:["browser_action"],onclick:function(){o.a.tabs.create({url:"tab.html"})}}),o.a.tabs.create({url:"tab.html"})},91:function(t,e,n){t.exports=n.p+"manifest.json"}});
//# sourceMappingURL=background.js.map