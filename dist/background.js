!function(e){function t(t){for(var r,c,i=t[0],u=t[1],s=t[2],p=0,f=[];p<i.length;p++)c=i[p],a[c]&&f.push(a[c][0]),a[c]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);f.length;)f.shift()();return o.push.apply(o,s||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,i=1;i<n.length;i++){var u=n[i];0!==a[u]&&(r=!1)}r&&(o.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},a={1:0},o=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var i=window.webpackJsonp=window.webpackJsonp||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var l=u;o.push([140,0]),n()}({138:function(e,t,n){"use strict";var r=n(19),a=n.n(r),o=n(14),c=n(135),i=n.n(c),u=n(72),s=n.n(u),l=n(23),p={chains:[{chainId:"testnet.aergo.io",nodeUrl:"http://testnet.aergo.io:7845"},{chainId:"main.aergo.io",nodeUrl:"https://mainnet-api-http.aergo.io"},{chainId:"aergo.io",nodeUrl:"https://mainnet-api-http.aergo.io"},{chainId:"sqltestnet.aergo.io",nodeUrl:"https://sqltestnet-api-http.aergo.io"},{chainId:"dev.chain",nodeUrl:"http://127.0.0.1:7845"}]},f=n(73),h=n(6);function d(e,t,n,r,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function v(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function c(e){d(o,r,a,c,i,"next",e)}function i(e){d(o,r,a,c,i,"throw",e)}c(void 0)})}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&m(e.prototype,t),n&&m(e,n)}(e,[{key:"fetchAccountTransactionsAfter",value:function(e){return function(e){return function(){var t=v(regeneratorRuntime.mark(function t(n){var r,a,o,c,i,u,s,p,f,d,v,m;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.account,a=n.blockno,o=n.limit,"testnet.aergo.io"===(c=r.data.spec.chainId)||"aergo.io"===c){t.next=4;break}return t.abrupt("return",e({account:r,blockno:a,limit:o}));case 4:return"testnet.aergo.io"==c&&(i="https://api.aergoscan.io/testnet"),"aergo.io"==c&&(i="https://api.aergoscan.io/main"),u=new h.Address(r.data.spec.address),console.log("[track account] Fetching txs for ".concat(u," on ").concat(c," since ").concat(a,"...")),s=encodeURIComponent("(from:".concat(u," OR to:").concat(u,") AND blockno:>").concat(a)),p=1e3,f=0,d="".concat(i,"/transactions?q=").concat(s,"&sort=blockno:desc&size=").concat(p,"&from=").concat(f),t.next=14,fetch(d);case 14:return v=t.sent,t.next=17,v.json();case 17:return m=t.sent,console.log("[track account] Got ".concat(m.hits.length," (of ").concat(m.total,") txs for ").concat(u," since ").concat(a,".")),t.abrupt("return",m.hits.map(function(e){return new l.Transaction(e.hash,{chainId:c,from:e.meta.from,to:e.meta.to,hash:e.hash,ts:e.meta.ts,blockhash:"",blockno:e.meta.blockno,amount:e.meta.amount,type:e.meta.type,status:l.Transaction.Status.Confirmed})}));case 20:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}}},{key:"fetchAccountTransactions",value:function(e){var t=this;return function(){return function(){var n=v(regeneratorRuntime.mark(function n(r){var a,o,c;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.accountManager.getCompleteAccountSpec(r.data.spec),n.next=3,e.getClient(a.chainId).blockchain();case 3:return o=n.sent,c=o.bestHeight,n.abrupt("return",t.fetchAccountTransactionsBefore(e)(v(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}},e,this)})))({account:r,blockno:c}));case 6:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}()}}}]),e}(),k=n(12);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var A=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=b(this,x(t).call(this)))._idleTimeout=null,e.set("initial"),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,o["EventEmitter"]),function(e,t,n){t&&y(e.prototype,t),n&&y(e,n)}(t,[{key:"set",value:function(e){var t=this;"inactive"!=e&&this._idleTimeout&&clearTimeout(this._idleTimeout),this.state!=e&&"inactive"==e&&(this._idleTimeout&&clearTimeout(this._idleTimeout),this._idleTimeout=setTimeout(function(){t.set("idle")},6e4)),this.state!=e&&console.log("[state] ".concat(this.state," -> ").concat(e)),this.state=e,this.emit("change",e),this.emit(e)}}]),t}(),O=(n(243),n(18),n(2));function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t,n,r,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function T(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function c(e){S(o,r,a,c,i,"next",e)}function i(e){S(o,r,a,c,i,"throw",e)}c(void 0)})}}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=M(this,U(t).call(this))).id=a.a.runtime.id,e.uiState={popupOpen:!1},e.state=new A,e._lockTimeout=null,e.wallet=new l.Wallet({appName:"aergo-browser-wallet",instanceId:e.id}),e.wallet.use(g),e.wallet.useStorage(f.a).then(T(regeneratorRuntime.mark(function t(){var n,r,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.firstLoad(),t.prev=1,t.next=4,e.wallet.datastore.getIndex("settings").get("customChains");case 4:for(n=t.sent,r=Object.keys(n.data),a=0;a<r.length;a++)o=r[a],e.wallet.useChain({chainId:o,nodeUrl:n.data[o].nodeUrl});t.next=11;break;case 9:t.prev=9,t.t0=t.catch(1);case 11:case"end":return t.stop()}},t,this,[[1,9]])})));var n=!0,r=!1,o=void 0;try{for(var c,i=p.chains[Symbol.iterator]();!(n=(c=i.next()).done);n=!0){var u=c.value;e.wallet.useChain(u)}}catch(e){r=!0,o=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}return e.wallet.keyManager.on("lock",function(){e.emit("update",{unlocked:!1}),console.log("[lock] locked")}),e.wallet.keyManager.on("unlock",function(){e.emit("update",{unlocked:!0}),console.log("[lock] unlocked")}),e.state.on("idle",function(){console.log("[state] idle, pausing trackers"),e.wallet.accountManager.pause(),e.wallet.transactionManager.pause()}),e.state.on("active",function(){console.log("[state] active, resuming trackers"),e.wallet.accountManager.resume(),e.wallet.transactionManager.resume()}),e.lock(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,o["EventEmitter"]),function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(t,[{key:"firstLoad",value:function(){var e=T(regeneratorRuntime.mark(function e(){var t,n,r,a,o,c,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wallet.accountManager.getAccounts();case 2:for(t=e.sent,n=!0,r=!1,a=void 0,e.prev=6,o=t[Symbol.iterator]();!(n=(c=o.next()).done);n=!0)i=c.value,this.trackAccount(i);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),r=!0,a=e.t0;case 14:e.prev=14,e.prev=15,n||null==o.return||o.return();case 17:if(e.prev=17,!r){e.next=20;break}throw a;case 20:return e.finish(17);case 21:return e.finish(14);case 22:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21]])}));return function(){return e.apply(this,arguments)}}()},{key:"lock",value:function(){this.wallet.lock()}},{key:"unlock",value:function(){var e=T(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wallet.unlock(t);case 2:this.keepUnlocked();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupAndUnlock",value:function(){var e=T(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.wallet.setupAndUnlock(t);case 2:this.keepUnlocked();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setActiveAccount",value:function(){var e=T(regeneratorRuntime.mark(function e(t){var n,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.chainId,r=t.address,e.next=3,this.wallet.accountManager.getOrAddAccount({address:r,chainId:n});case 3:a=e.sent,this.activeAccount=a,console.log("Active account is now",{chainId:n,address:r});case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getActiveAccount",value:function(){var e=T(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.activeAccount);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"keepUnlocked",value:function(){var e=this;this._lockTimeout&&clearTimeout(this._lockTimeout),this._lockTimeout=setTimeout(function(){console.log("[lock] auto-locking..."),e.lock()},6e4)}},{key:"isUiOpen",value:function(){return this.uiState.popupOpen}},{key:"trackAccount",value:function(e,t){var n=this,r=this.wallet.accountManager.trackAccount(e);this.wallet.transactionManager.trackAccount(e),r.then(function(e){e.removeAllListeners("update"),e.on("update",function(e){console.log("got new state",e),n.emit("update",{accounts:[e]}),t&&(t(e),t=!1)})})}},{key:"permissionRequest",value:function(e,t){confirm(e)&&t()}},{key:"signMessage",value:function(){var e=T(regeneratorRuntime.mark(function e(t){var n,r,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.address,r=t.chainId,a=t.message,this.keepUnlocked(),e.next=4,this.wallet.accountManager.getOrAddAccount({address:n,chainId:r});case 4:return o=e.sent,e.next=7,this.wallet.keyManager.signMessage(o,O.Buffer.from(a));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupCommunication",value:function(e){var t=this,n=s()({unlock:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.password,e.prev=1,e.next=4,t.unlock(a);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),console.error(e.t0),r({error:""+e.t0}),e.abrupt("return");case 11:r({});case 12:case"end":return e.stop()}},e,this,[[1,6]])}));return function(t,n){return e.apply(this,arguments)}}(),lock:function(){var e=T(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.lock(),n({});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),setup:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.password,e.next=3,t.setupAndUnlock(a);case 3:r({});case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),isUnlocked:function(){var e=T(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n(t.wallet.unlocked);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),reset:function(){var e=T(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.wallet.deleteAllData();case 2:n();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),addNetwork:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a,o,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.chainId,o=n.nodeUrl,console.log("Adding chain",{chainId:a,nodeUrl:o}),t.wallet.useChain({chainId:a,nodeUrl:o}),c={},e.prev=4,e.next=7,t.wallet.datastore.getIndex("settings").get("customChains");case 7:c=e.sent.data,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:return c[a]={chainId:a,nodeUrl:o},e.next=15,t.wallet.datastore.getIndex("settings").put({key:"customChains",data:c});case 15:r({});case 16:case"end":return e.stop()}},e,this,[[4,10]])}));return function(t,n){return e.apply(this,arguments)}}(),getBlockchainStatus:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.chainId,e.next=3,t.wallet.getClient(a).blockchain();case 3:o=e.sent,r({blockHeight:o.bestHeight,chainId:a});case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),getAccounts:function(){var e=T(regeneratorRuntime.mark(function e(n){var r,a,o,c,i,u,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.keepUnlocked(),e.next=3,t.wallet.accountManager.getAccounts();case 3:for(r=e.sent,a=!0,o=!1,c=void 0,e.prev=7,i=r[Symbol.iterator]();!(a=(u=i.next()).done);a=!0)s=u.value,t.trackAccount(s);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),o=!0,c=e.t0;case 15:e.prev=15,e.prev=16,a||null==i.return||i.return();case 18:if(e.prev=18,!o){e.next=21;break}throw c;case 21:return e.finish(18);case 22:return e.finish(15);case 23:n(r);case 24:case"end":return e.stop()}},e,this,[[7,11,15,23],[16,,18,22]])}));return function(t){return e.apply(this,arguments)}}(),createAccount:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.chainId,t.keepUnlocked(),e.prev=2,e.next=5,t.wallet.accountManager.createAccount(a);case 5:o=e.sent,t.trackAccount(o),r(o.data.spec),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),r({error:e.t0});case 13:case"end":return e.stop()}},e,this,[[2,10]])}));return function(t,n){return e.apply(this,arguments)}}(),removeAccount:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.chainId,o=n.address,e.next=3,t.wallet.accountManager.removeAccount({chainId:a,address:o});case 3:r();case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),setActiveAccount:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.chainId,o=n.address,e.next=3,t.setActiveAccount({chainId:a,address:o});case 3:r();case 4:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),importAccount:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a,o,c,i,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.privateKey,o=n.chainId,t.keepUnlocked(),c=Object(k.identifyFromPrivateKey)(a),i=c.address,e.prev=4,e.next=7,t.wallet.accountManager.addAccount({address:i,chainId:o});case 7:return u=e.sent,console.log("importAccount",u,a),e.next=11,t.wallet.keyManager.importKey({account:u,privateKey:a});case 11:t.trackAccount(u),r(u.data.spec),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(4),console.error(e.t0),r({error:"Could not import account. "+e.t0});case 19:case"end":return e.stop()}},e,this,[[4,15]])}));return function(t,n){return e.apply(this,arguments)}}(),exportAccount:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a,o,c,i,u,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.address,o=n.chainId,c=n.password,t.keepUnlocked(),e.next=4,t.wallet.accountManager.getOrAddAccount({address:a,chainId:o});case 4:return i=e.sent,e.next=7,t.wallet.keyManager.getUnlockedKey(i);case 7:return u=e.sent,console.log(i,u),s=u.data.privateKey,e.next=12,Object(k.encryptPrivateKey)(s,c);case 12:l=e.sent,r({privateKey:Object(k.encodePrivateKey)(l)});case 14:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),sendTransaction:function(){var e=T(regeneratorRuntime.mark(function e(n,r,a){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.keepUnlocked(),e.prev=1,e.next=4,t.wallet.sendTransaction({address:n.from,chainId:r},n);case 4:o=e.sent,console.log(o,o.transaction.txBody),a({tx:o.transaction.txBody}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.error(e.t0),a({error:e.t0.message||""+e.t0});case 13:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t,n,r){return e.apply(this,arguments)}}(),getAccountTx:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("getAccountTx",n),n.address){e.next=3;break}return e.abrupt("return",r({}));case 3:return e.next=5,t.wallet.transactionManager.getAccountTransactions(n);case 5:(a=e.sent).sort(function(e,t){return e.data.ts<t.data.ts?1:e.data.ts==t.data.ts?0:-1}),r(a);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),syncAccountState:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.address){e.next=2;break}return e.abrupt("return",r({}));case 2:return e.next=4,t.wallet.accountManager.getOrAddAccount(n);case 4:a=e.sent,t.trackAccount(a,r);case 6:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),signMessage:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a,o,c,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.address,o=n.chainId,c=n.message,e.prev=1,e.next=4,t.signMessage({address:a,chainId:o,message:c});case 4:i=e.sent,r({signedMessage:i}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0),r({error:e.t0});case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t,n){return e.apply(this,arguments)}}(),getStaking:function(){var e=T(regeneratorRuntime.mark(function e(n,r){var a,o,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.address,o=n.chainId,t.keepUnlocked(),e.prev=2,e.next=5,t.wallet.getClient(o).getStaking(a);case 5:c=e.sent,r({amount:c.amount.toString(),when:c.when}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),r({error:e.t0});case 12:case"end":return e.stop()}},e,this,[[2,9]])}));return function(t,n){return e.apply(this,arguments)}}()});i()(e,n,e,function(e){e&&log.error(e)}),n.on("remote",function(e){var n=e.sendUpdate.bind(e);t.on("update",n)}),this.state.on("change",function(e){t.emit("update",{state:e})})}}]),t}();t.a=E},140:function(e,t,n){"use strict";n.r(t),function(e){n(88);var t=n(19),r=n.n(t),a=n(86),o=n.n(a),c=n(71),i=n.n(c),u=n(138);function s(e,t,n,r,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,a)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function c(e){s(o,r,a,c,i,"next",e)}function i(e){s(o,r,a,c,i,"throw",e)}c(void 0)})}}function p(){return(p=l(regeneratorRuntime.mark(function t(){var n,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=function(t){var r=t.name;if(console.log("Establishing connection with",r),"external"===r)t.onMessage.addListener(function(){var t=l(regeneratorRuntime.mark(function t(r,a){var o,c,i,u,s,p,f,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("AERGO_REQUEST"===r.type){t.next=2;break}return t.abrupt("return");case 2:if(console.log("received message",r,a.sender.url),"ACTIVE_ACCOUNT"!==(o=r.action||"")){t.next=14;break}return t.next=7,n.getActiveAccount();case 7:if(c=t.sent){t.next=12;break}return i="The website at\n\n".concat(a.sender.url,"\n\n")+"asks for permission to access your active account.\n\nYou have no active account. Make sure to select an account inside Aergo Connect.",alert(i),t.abrupt("return");case 12:u="The website at\n\n".concat(a.sender.url,"\n\nasks for permission to access your active account\n\n").concat(c.key),n.permissionRequest(u,function(){a.postMessage({type:"AERGO_RESPONSE",eventName:"AERGO_ACTIVE_ACCOUNT",result:{account:c.data.spec}})});case 14:if("SIGN"!==o){t.next=31;break}return t.next=17,n.getActiveAccount();case 17:if(s=t.sent,p=r.data.hash,f="The website at\n\n".concat(a.sender.url,"\n\nasks for permission to sign the message\n\n").concat(p,"\n\nwith your account\n\n").concat(s.key),h=p,"0x"!==p.substr(0,2)){t.next=30;break}t.prev=22,h=e.from(p.substr(2),"hex"),t.next=30;break;case 26:return t.prev=26,t.t0=t.catch(22),console.error(t.t0),t.abrupt("return");case 30:n.permissionRequest(f,l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=a,e.t1=s.data.spec,e.next=4,n.signMessage({address:s.data.spec.address,chainId:s.data.spec.chainId,message:h});case 4:e.t2=e.sent,e.t3={account:e.t1,signature:e.t2},e.t4={type:"AERGO_RESPONSE",eventName:"AERGO_SIGN_RESULT",result:e.t3},e.t0.postMessage.call(e.t0,e.t4);case 8:case"end":return e.stop()}},e,this)})));case 31:case"end":return t.stop()}},t,this,[[22,26]])}));return function(e,n){return t.apply(this,arguments)}}());else{var a=new i.a(t);n.state.set("active"),n.setupCommunication(a),n.uiState.popupOpen=!0,o()(a,function(){n.uiState.popupOpen=!1,console.log("Closed connection with",r),n.state.set("inactive")})}},n=new u.a,r.a.runtime.onConnect.addListener(a);case 3:case"end":return t.stop()}},t,this)}))).apply(this,arguments)}n(144),console.log("AERGO Wallet Background Script"),console.log("Extension ID",r.a.runtime.id),function(){p.apply(this,arguments)}(),chrome.contextMenus.removeAll(),chrome.contextMenus.create({title:"Open full page",contexts:["browser_action"],onclick:function(){r.a.tabs.create({url:"tab.html"})}})}.call(this,n(2).Buffer)},144:function(e,t,n){e.exports=n.p+"manifest.json"},155:function(e,t){}});
//# sourceMappingURL=background.js.map