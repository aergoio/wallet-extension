!function(e){function t(t){for(var r,i,c=t[0],u=t[1],s=t[2],p=0,l=[];p<c.length;p++)i=c[p],o[i]&&l.push(o[i][0]),o[i]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(f&&f(t);l.length;)l.shift()();return a.push.apply(a,s||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,c=1;c<n.length;c++){var u=n[c];0!==o[u]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={1:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var c=window.webpackJsonp=window.webpackJsonp||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var f=u;a.push([188,0]),n()}({188:function(e,t,n){"use strict";n.r(t);n(55);var r=n(20),o=n.n(r),a=n(53),i=n.n(a),c=n(44),u=n.n(c),s=n(11),f=n(75),p=n.n(f),l=n(45),h=n.n(l),v=n(4),b=n.n(v),m=n(6),d=n(76);function y(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),e}var O=function(){function e(t,n,r){w(this,e),this.name=n,this.db=t,this.keyPath=r}return k(e,[{key:"get",value:function(e){return this.db.transaction(this.name).objectStore(this.name).get(e)}},{key:"getAll",value:function(){return this.db.transaction(this.name).objectStore(this.name).getAll()}},{key:"put",value:function(e,t){var n,r=this.db.transaction(this.name,"readwrite");return r.objectStore(this.name).put((g(n={},this.keyPath,e),g(n,"data",t),n)),r.complete}},{key:"delete",value:function(e){return this.db.transaction(this.name).objectStore(this.name).delete(e)}}]),e}(),S=function(){function e(){w(this,e)}return k(e,[{key:"open",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){y(a,r,o,i,c,"next",e)}function c(e){y(a,r,o,i,c,"throw",e)}i(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.db){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Object(d.openDb)("aergowallet",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore("tx",{keyPath:"hash"}),e.createObjectStore("accounts",{keyPath:"id"})}});case 4:this.db=e.sent,this.transactions=new O(this.db,"tx","hash"),this.accounts=new O(this.db,"accounts","id");case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),j=(n(117),n(10));n(46),n(5);function P(e){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function _(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){R(a,r,o,i,c,"next",e)}function c(e){R(a,r,o,i,c,"throw",e)}i(void 0)})}}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function K(e){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=A(this,K(t).call(this))).uiState={popupOpen:!1};var n=new v.GrpcWebProvider({url:Object(j.b)(j.a).nodeUrl});return e.aergo=new b.a({},n),e.store=new S,e._stateTimeout=null,e.setState("initial"),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,s["EventEmitter"]),function(e,t,n){t&&T(e.prototype,t),n&&T(e,n)}(t,[{key:"setState",value:function(e){var t=this;"inactive"!=e&&this._stateTimeout&&clearTimeout(this._stateTimeout),this.state!=e&&"inactive"==e&&(this._stateTimeout&&clearTimeout(this._stateTimeout),this._stateTimeout=setTimeout(function(){t.setState("idle")},6e4)),this.state!=e&&console.log("[state] ".concat(this.state," -> ").concat(e)),this.state=e}},{key:"isUiOpen",value:function(){return this.uiState.popupOpen}},{key:"setupCommunication",value:function(e){var t=this,n=h()({getBlockchainStatus:function(){var e=_(regeneratorRuntime.mark(function e(n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.aergo.blockchain();case 2:r=e.sent,n({blockHeight:r.bestHeight});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),getAccounts:function(){var e=_(regeneratorRuntime.mark(function e(n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.store.open();case 2:return e.next=4,t.store.accounts.getAll();case 4:r=e.sent,n(r);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),createAccount:function(){var e=_(regeneratorRuntime.mark(function e(n,r){var o,a,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.name,n.password,a=j.a,e.next=4,Object(m.createIdentity)();case 4:return i=e.sent,c=i.address,e.next=8,t.store.open();case 8:return e.next=10,t.store.accounts.put(c,{balance:0,publicKey:i.publicKey.encodeCompressed(),privateKey:i.privateKey.toArray(),chain:a,name:o});case 10:r({address:c});case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),importAccount:function(){var e=_(regeneratorRuntime.mark(function e(n,r){var o,a,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.privateKey,a=j.a,i=Object(m.identifyFromPrivateKey)(o),c=i.address,e.next=6,t.store.open();case 6:return e.next=8,t.store.accounts.put(c,{balance:0,publicKey:i.publicKey.encodeCompressed(),privateKey:i.privateKey.toArray(),chain:a,name:name});case 8:r({address:c});case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),sendTransaction:function(){var e=_(regeneratorRuntime.mark(function e(n,r){var o,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.store.open();case 2:return e.next=4,t.store.accounts.get(n.from);case 4:return o=e.sent,a=Object(m.identifyFromPrivateKey)(o.data.privateKey),i=new v.Amount(n.amount).toUnit("aer"),e.next=9,t.aergo.getNonce(n.from);case 9:return e.t0=e.sent,n.nonce=1+e.t0,n.amount=i.value.toString(),e.next=14,Object(m.signTransaction)(n,a.keyPair);case 14:return n.sign=e.sent,e.next=17,Object(m.hashTransaction)(n,"bytes");case 17:return n.hash=e.sent,n.amount=i.toString(),e.prev=19,e.next=22,t.aergo.sendSignedTransaction(n);case 22:n.hash=e.sent,r({tx:n}),e.next=30;break;case 26:e.prev=26,e.t1=e.catch(19),console.error(e.t1),r({error:""+e.t1});case 30:case"end":return e.stop()}},e,this,[[19,26]])}));return function(t,n){return e.apply(this,arguments)}}(),syncAccountTx:function(){var e=_(regeneratorRuntime.mark(function e(n,r){var o,a,i,c,u,s,f,p,l,h,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.store.open();case 2:return e.next=4,t.store.accounts.get(n);case 4:return o=e.sent,a=Object(j.b)(o.data.chain).apiUrl("/transactions?q=from:".concat(n,"%20OR%20to:").concat(n,"&sort=blockno:desc")),e.next=8,fetch(a);case 8:return i=e.sent,e.next=11,i.json();case 11:c=e.sent,u=!0,s=!1,f=void 0,e.prev=15,p=c.hits[Symbol.iterator]();case 17:if(u=(l=p.next()).done){e.next=24;break}return h=l.value,e.next=21,t.store.transactions.put(h.hash,h.meta);case 21:u=!0,e.next=17;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(15),s=!0,f=e.t0;case 30:e.prev=30,e.prev=31,u||null==p.return||p.return();case 33:if(e.prev=33,!s){e.next=36;break}throw f;case 36:return e.finish(33);case 37:return e.finish(30);case 38:return e.next=40,t.store.transactions.getAll();case 40:(v=e.sent).sort(function(e,t){return-(e.data.blockno-t.data.blockno)}),console.log(v),r(v);case 44:case"end":return e.stop()}},e,this,[[15,26,30,38],[31,,33,37]])}));return function(t,n){return e.apply(this,arguments)}}(),syncAccountState:function(){var e=_(regeneratorRuntime.mark(function e(n,r){var o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.store.open();case 2:return e.next=4,t.store.accounts.get(n);case 4:return o=e.sent,e.next=7,t.aergo.getState(n);case 7:a=e.sent,console.log(a),o.data.balance=a.balance.toString(),t.store.accounts.put(n,o.data),r(o);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()});p()(e,n,e,function(e){e&&log.error(e)}),n.on("remote",function(e){var n=e.sendUpdate.bind(e);t.on("update",n)})}}]),t}();function M(e,t,n,r,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,o)}function U(){return(U=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){M(a,r,o,i,c,"next",e)}function c(e){M(a,r,o,i,c,"throw",e)}i(void 0)})}}(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=function(e){var n=e.name;console.log("Establishing connection with",n),t.setState("active");var r=new u.a(e);t.setupCommunication(r),t.uiState.popupOpen=!0,i()(r,function(){t.uiState.popupOpen=!1,console.log("Closed connection with",n),t.setState("inactive")})},t=new E,o.a.runtime.onConnect.addListener(n);case 3:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}console.log("AERGO Wallet Background Script"),n(82),function(){U.apply(this,arguments)}(),chrome.contextMenus.removeAll(),chrome.contextMenus.create({title:"Open full page",contexts:["browser_action"],onclick:function(){o.a.tabs.create({url:"tab.html"})}}),o.a.tabs.create({url:"tab.html"})},82:function(e,t,n){e.exports=n.p+"manifest.json"},95:function(e,t){}});
//# sourceMappingURL=background.js.map