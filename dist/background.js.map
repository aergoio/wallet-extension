{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/manifest.json","webpack:///./src/controllers/config.js","webpack:///./src/controllers/tx-scanner.js","webpack:///./src/controllers/state.js","webpack:///./src/controllers/background.js","webpack:///./src/background.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","config","chains","chainId","nodeUrl","tx_scanner_AergoscanTransactionScanner","AergoscanTransactionScanner","_classCallCheck","this","_createClass","wallet","next","_ref2","_asyncToGenerator","regeneratorRuntime","mark","_callee","_ref","account","blockno","limit","address","q","size","offset","url","response","wrap","_context","prev","spec","abrupt","herajs","console","log","concat","encodeURIComponent","fetch","sent","json","hits","total","map","tx","herajs_wallet_iife","hash","from","meta","to","ts","blockhash","amount","type","status","Status","Confirmed","stop","_x","arguments","_this","_ref3","_callee3","accountSpec","_ref4","bestHeight","_context3","accountManager","getCompleteAccountSpec","getClient","blockchain","fetchAccountTransactionsBefore","_callee2","_context2","_x2","state","State","state_classCallCheck","_possibleConstructorReturn","_getPrototypeOf","_idleTimeout","set","events","nextState","_this2","clearTimeout","setTimeout","emit","background","BackgroundController","background_classCallCheck","background_possibleConstructorReturn","background_getPrototypeOf","id","extensionizer_default","a","runtime","uiState","popupOpen","_lockTimeout","appName","instanceId","use","useStorage","store","then","firstLoad","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","iterator","done","chain","useChain","err","return","keyManager","on","unlocked","pause","transactionManager","resume","lock","getAccounts","accounts","_iterator2","_iteratorNormalCompletion2","_step2","trackAccount","passphrase","unlock","keepUnlocked","setupAndUnlock","onceCb","_this3","accountTracker","removeAllListeners","outStream","_this4","dnode","browser_default","_unlock2","background_asyncToGenerator","_callee4","send","password","_context4","t0","error","_x3","_x4","_lock","_callee5","_context5","_x5","setup","_setup","_callee6","_context6","_x6","_x7","isUnlocked","_isUnlocked","_callee7","_context7","_x8","reset","_reset","_callee8","_context8","open","getIndex","clear","_x9","getBlockchainStatus","_getBlockchainStatus","_callee9","_context9","blockHeight","defaultChainId","_x10","_getAccounts","_callee10","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","_context10","finish","_x11","createAccount","_createAccount","_callee11","_context11","_x12","_x13","importAccount","_importAccount","_callee12","privateKey","identity","_context12","herajs_crypto_umd","addAccount","importKey","_x14","_x15","exportAccount","_exportAccount","_callee13","_ref5","privkeyEncrypted","_context13","masterPassword","_x16","_x17","sendTransaction","_sendTransaction","_callee14","txTracker","_context14","transaction","txBody","message","_x18","_x19","_x20","getAccountTx","_getAccountTx","_callee15","txs","_context15","getAccountTransactions","sort","b","_x21","_x22","syncAccountState","_syncAccountState","_callee16","_context16","getOrCreateAccount","_x23","_x24","pump_default","remote","sendUpdate","controller","connectRemote","remotePort","processName","portStream","extension_port_stream_default","setupCommunication","end_of_stream_default","onConnect","addListener","setupController","chrome","contextMenus","removeAll","title","contexts","onclick","tabs"],"mappings":"aACA,SAAAA,EAAAC,GAQA,IAPA,IAMAC,EAAAC,EANAC,EAAAH,EAAA,GACAI,EAAAJ,EAAA,GACAK,EAAAL,EAAA,GAIAM,EAAA,EAAAC,KACQD,EAAAH,EAAAK,OAAoBF,IAC5BJ,EAAAC,EAAAG,GACAG,EAAAP,IACAK,EAAAG,KAAAD,EAAAP,GAAA,IAEAO,EAAAP,GAAA,EAEA,IAAAD,KAAAG,EACAO,OAAAC,UAAAC,eAAAC,KAAAV,EAAAH,KACAc,EAAAd,GAAAG,EAAAH,IAKA,IAFAe,KAAAhB,GAEAO,EAAAC,QACAD,EAAAU,OAAAV,GAOA,OAHAW,EAAAR,KAAAS,MAAAD,EAAAb,OAGAe,IAEA,SAAAA,IAEA,IADA,IAAAC,EACAf,EAAA,EAAiBA,EAAAY,EAAAV,OAA4BF,IAAA,CAG7C,IAFA,IAAAgB,EAAAJ,EAAAZ,GACAiB,GAAA,EACAC,EAAA,EAAkBA,EAAAF,EAAAd,OAA2BgB,IAAA,CAC7C,IAAAC,EAAAH,EAAAE,GACA,IAAAf,EAAAgB,KAAAF,GAAA,GAEAA,IACAL,EAAAQ,OAAApB,IAAA,GACAe,EAAAM,IAAAC,EAAAN,EAAA,KAGA,OAAAD,EAIA,IAAAQ,KAKApB,GACAqB,EAAA,GAGAZ,KAGA,SAAAS,EAAA1B,GAGA,GAAA4B,EAAA5B,GACA,OAAA4B,EAAA5B,GAAA8B,QAGA,IAAAC,EAAAH,EAAA5B,IACAK,EAAAL,EACAgC,GAAA,EACAF,YAUA,OANAhB,EAAAd,GAAAa,KAAAkB,EAAAD,QAAAC,IAAAD,QAAAJ,GAGAK,EAAAC,GAAA,EAGAD,EAAAD,QAKAJ,EAAAO,EAAAnB,EAGAY,EAAAQ,EAAAN,EAGAF,EAAAS,EAAA,SAAAL,EAAAM,EAAAC,GACAX,EAAAY,EAAAR,EAAAM,IACA1B,OAAA6B,eAAAT,EAAAM,GAA0CI,YAAA,EAAAC,IAAAJ,KAK1CX,EAAAgB,EAAA,SAAAZ,GACA,oBAAAa,eAAAC,aACAlC,OAAA6B,eAAAT,EAAAa,OAAAC,aAAwDC,MAAA,WAExDnC,OAAA6B,eAAAT,EAAA,cAAiDe,OAAA,KAQjDnB,EAAAoB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAAnB,EAAAmB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAvC,OAAAwC,OAAA,MAGA,GAFAxB,EAAAgB,EAAAO,GACAvC,OAAA6B,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAAnB,EAAAS,EAAAc,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAvB,EAAA2B,EAAA,SAAAtB,GACA,IAAAM,EAAAN,KAAAiB,WACA,WAA2B,OAAAjB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAL,EAAAS,EAAAE,EAAA,IAAAA,GACAA,GAIAX,EAAAY,EAAA,SAAAgB,EAAAC,GAAsD,OAAA7C,OAAAC,UAAAC,eAAAC,KAAAyC,EAAAC,IAGtD7B,EAAA8B,EAAA,GAEA,IAAAC,EAAAC,OAAA,aAAAA,OAAA,iBACAC,EAAAF,EAAAhD,KAAA2C,KAAAK,GACAA,EAAAhD,KAAAX,EACA2D,IAAAG,QACA,QAAAvD,EAAA,EAAgBA,EAAAoD,EAAAlD,OAAuBF,IAAAP,EAAA2D,EAAApD,IACvC,IAAAU,EAAA4C,EAIA1C,EAAAR,MAAA,QAEAU,0BCtJAY,EAAAD,QAAiBJ,EAAA8B,EAAuB,6LCAzBK,GACXC,SAEQC,QAAS,mBACTC,QAAS,iCAGTD,QAAS,YACTC,QAAS,0gBCAd,IAAMC,EAAb,oBAAAC,iGAAAC,CAAAC,KAAAF,GAAA,qDAAAG,CAAAH,IAAAf,IAAA,gCAAAN,MAAA,SACkCyB,GAC1B,OAAO,SAACC,GAAD,sBAAAC,EAAAC,EAAAC,mBAAAC,KAAU,SAAAC,EAAAC,GAAA,IAAAC,EAAAC,EAAAC,EAAAjB,EAAAkB,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAvF,EAAA,OAAA2E,mBAAAa,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAjB,MAAA,UAASO,EAATD,EAASC,QAASC,EAAlBF,EAAkBE,QAASC,EAA3BH,EAA2BG,MAExB,sBADVjB,EAAUe,EAAQ/E,KAAK2F,KAAK3B,SADrB,CAAAyB,EAAAjB,KAAA,eAAAiB,EAAAG,OAAA,SAGFpB,GAAOO,UAASC,UAASC,WAHvB,cAKPC,EAAU,IAAIW,EAAA,QAAQd,EAAQ/E,KAAK2F,KAAKT,SAC9CY,QAAQC,IAAR,oCAAAC,OAAgDd,EAAhD,QAAAc,OAA8DhC,EAA9D,WAAAgC,OAA+EhB,EAA/E,QACMG,EAAIc,mBAAkB,SAAAD,OAAUd,EAAV,WAAAc,OAA2Bd,EAA3B,mBAAAc,OAAoDhB,IAE1EI,EAAO,IACPC,EAAS,EACTC,EAXO,GAAAU,OAQG,mCARH,oBAAAA,OAW4Bb,EAX5B,4BAAAa,OAWwDZ,EAXxD,UAAAY,OAWqEX,GAXrEI,EAAAjB,KAAA,GAYU0B,MAAMZ,GAZhB,eAYPC,EAZOE,EAAAU,KAAAV,EAAAjB,KAAA,GAaMe,EAASa,OAbf,eAaPpG,EAbOyF,EAAAU,KAcbL,QAAQC,IAAR,uBAAAC,OAAmChG,EAAKqG,KAAK7F,OAA7C,SAAAwF,OAA2DhG,EAAKsG,MAAhE,cAAAN,OAAkFd,EAAlF,WAAAc,OAAmGhB,EAAnG,MAdaS,EAAAG,OAAA,SAeN5F,EAAKqG,KAAKE,IAAI,SAAAC,GAAE,OAAI,IAAIC,EAAA,YAAYD,EAAGE,MAC1C1C,UACA2C,KAAMH,EAAGI,KAAKD,KACdE,GAAIL,EAAGI,KAAKC,GACZH,KAAMF,EAAGE,KACTI,GAAIN,EAAGI,KAAKE,GACZC,UAAW,GACX/B,QAASwB,EAAGI,KAAK5B,QACjBgC,OAAQR,EAAGI,KAAKI,OAChBC,KAAMT,EAAGI,KAAKK,KACdC,OAAQT,EAAA,YAAYU,OAAOC,eAzBlB,yBAAA3B,EAAA4B,SAAAxC,EAAAR,SAAV,gBAAAiD,GAAA,OAAA7C,EAAAtD,MAAAkD,KAAAkD,YAAA,OAFfnE,IAAA,2BAAAN,MAAA,SAgC6ByB,GAAQ,IAAAiD,EAAAnD,KAC7B,OAAO,iCAAAoD,EAAA/C,EAAAC,mBAAAC,KAAM,SAAA8C,EAAO3C,GAAP,IAAA4C,EAAAC,EAAAC,EAAA,OAAAlD,mBAAAa,KAAA,SAAAsC,GAAA,cAAAA,EAAApC,KAAAoC,EAAAtD,MAAA,cACHmD,EAAcpD,EAAOwD,eAAeC,uBAAuBjD,EAAQ/E,KAAK2F,MADrEmC,EAAAtD,KAAA,EAEoBD,EAAO0D,UAAUN,EAAY3D,SAASkE,aAF1D,cAAAN,EAAAE,EAAA3B,KAED0B,EAFCD,EAEDC,WAFCC,EAAAlC,OAAA,SAGF4B,EAAKW,+BAA+B5D,EAApCiD,CAAA9C,EAAAC,mBAAAC,KAA4C,SAAAwD,IAAA,OAAAzD,mBAAAa,KAAA,SAAA6C,GAAA,cAAAA,EAAA3C,KAAA2C,EAAA7D,MAAA,cAAA6D,EAAAzC,OAAA,qCAAAyC,EAAAhB,SAAAe,EAAA/D,SAA5CmD,EAA8DzC,UAASC,QAAS6C,KAH9E,wBAAAC,EAAAT,SAAAK,EAAArD,SAAN,gBAAAiE,GAAA,OAAAb,EAAAtG,MAAAkD,KAAAkD,YAAA,QAjCfpD,EAAA,kzBCNA,IAsCeoE,cAnCX,SAAAC,IAAc,IAAAhB,EAAA,mGAAAiB,CAAApE,KAAAmE,IACVhB,EAAAkB,EAAArE,KAAAsE,EAAAH,GAAA1H,KAAAuD,QACKuE,aAAe,KACpBpB,EAAKqB,IAAI,WAHCrB,8OADEsB,EAAA,6FAaZC,GAAW,IAAAC,EAAA3E,KACM,YAAb0E,GACI1E,KAAKuE,cACLK,aAAa5E,KAAKuE,cAGtBvE,KAAKkE,OAASQ,GAA0B,YAAbA,IACvB1E,KAAKuE,cACLK,aAAa5E,KAAKuE,cAEtBvE,KAAKuE,aAAeM,WAAW,WAC3BF,EAAKH,IAAI,SA1BJ,MA6BTxE,KAAKkE,OAASQ,GACdjD,QAAQC,IAAR,WAAAC,OAAuB3B,KAAKkE,MAA5B,QAAAvC,OAAwC+C,IAE5C1E,KAAKkE,MAAQQ,EACb1E,KAAK8E,KAAK,SAAUJ,GACpB1E,KAAK8E,KAAKJ,+nCCPlB,IAkPeK,cA/OX,SAAAC,IAAc,IAAA7B,+FAAA8B,CAAAjF,KAAAgF,IACV7B,EAAA+B,EAAAlF,KAAAmF,EAAAH,GAAAvI,KAAAuD,QAEKoF,GAAKC,EAAAC,EAAUC,QAAQH,GAE5BjC,EAAKqC,SACDC,WAAW,GAEftC,EAAKe,MAAQ,IAAIA,EACjBf,EAAKuC,aAAe,KAGpBvC,EAAKjD,OAAS,IAAIkC,EAAA,QACduD,QAAS,uBACTC,WAAYzC,EAAKiC,KAErBjC,EAAKjD,OAAO2F,IAAIhG,GAChBsD,EAAKjD,OAAO4F,WAAWC,EAAA,GAAOC,KAAK,WAC/B7C,EAAK8C,cAlBC,IAAAC,GAAA,EAAAC,GAAA,EAAAC,OAAAC,EAAA,IAoBV,QAAAC,EAAAC,EAAkB9G,EAAOC,OAAzBnB,OAAAiI,cAAAN,GAAAI,EAAAC,EAAApG,QAAAsG,MAAAP,GAAA,EAAiC,KAAxBQ,EAAwBJ,EAAA7H,MAC7B0E,EAAKjD,OAAOyG,SAASD,IArBf,MAAAE,GAAAT,GAAA,EAAAC,EAAAQ,EAAA,YAAAV,GAAA,MAAAK,EAAAM,QAAAN,EAAAM,SAAA,WAAAV,EAAA,MAAAC,GAAA,OAwBVjD,EAAKjD,OAAO4G,WAAWC,GAAG,OAAQ,WAC9B5D,EAAK2B,KAAK,UAAYkC,UAAU,IAChCvF,QAAQC,IAAI,mBAEhByB,EAAKjD,OAAO4G,WAAWC,GAAG,SAAU,WAChC5D,EAAK2B,KAAK,UAAYkC,UAAU,IAChCvF,QAAQC,IAAI,qBAGhByB,EAAKe,MAAM6C,GAAG,OAAQ,WAClBtF,QAAQC,IAAI,kCACZyB,EAAKjD,OAAOwD,eAAeuD,QAC3B9D,EAAKjD,OAAOgH,mBAAmBD,UAEnC9D,EAAKe,MAAM6C,GAAG,SAAU,WACpBtF,QAAQC,IAAI,qCACZyB,EAAKjD,OAAOwD,eAAeyD,SAC3BhE,EAAKjD,OAAOgH,mBAAmBC,WAGnChE,EAAKiE,OA5CKjE,8OADiBsB,EAAA,mQAiDJzE,KAAKE,OAAOwD,eAAe2D,qBAClD,IADMC,qCACNC,EAAoBD,EAApB/I,OAAAiI,cAAAgB,GAAAC,EAAAF,EAAApH,QAAAsG,MAAAe,GAAA,EAAS9G,EAAqB+G,EAAAhJ,MAC1BuB,KAAK0H,aAAahH,iYAKtBV,KAAKE,OAAOkH,mFAGFO,kGACJ3H,KAAKE,OAAO0H,OAAOD,UACzB3H,KAAK6H,sMAGaF,kGACZ3H,KAAKE,OAAO4H,eAAeH,UACjC3H,KAAK6H,yJAGM,IAAAlD,EAAA3E,KACPA,KAAK0F,cACLd,aAAa5E,KAAK0F,cAEtB1F,KAAK0F,aAAeb,WAAW,WAC3BpD,QAAQC,IAAI,0BACZiD,EAAKyC,QA7ES,wCAkFlB,OAAOpH,KAAKwF,QAAQC,+CAGX/E,EAASqH,GAAQ,IAAAC,EAAAhI,KACpBiI,EAAiBjI,KAAKE,OAAOwD,eAAegE,aAAahH,GAC/DV,KAAKE,OAAOgH,mBAAmBQ,aAAahH,GAC5CuH,EAAejC,KAAK,SAAAtH,GAChBA,EAAEwJ,mBAAmB,UACrBxJ,EAAEqI,GAAG,SAAU,SAAArG,GACXe,QAAQC,IAAI,gBAAiBhB,GAC7BsH,EAAKlD,KAAK,UAAYwC,UAAW5G,KAC7BqH,IACAA,EAAOrH,GACPqH,GAAS,kDAMLI,GAAW,IAAAC,EAAApI,KAErBqI,EAAQC,KACVV,OAAM,eAAAW,EAAAC,EAAAlI,mBAAAC,KAAE,SAAAkI,EAAAhI,EAAqBiI,GAArB,IAAAC,EAAA,OAAArI,mBAAAa,KAAA,SAAAyH,GAAA,cAAAA,EAAAvH,KAAAuH,EAAAzI,MAAA,cAASwI,EAATlI,EAASkI,SAATC,EAAAvH,KAAA,EAAAuH,EAAAzI,KAAA,EAEMiI,EAAKR,OAAOe,GAFlB,OAAAC,EAAAzI,KAAA,uBAAAyI,EAAAvH,KAAA,EAAAuH,EAAAC,GAAAD,EAAA,SAIAnH,QAAQqH,MAARF,EAAAC,IACAH,GAAOI,MAAO,GAAAF,EAAAC,KALdD,EAAArH,OAAA,kBAQJmH,MARI,yBAAAE,EAAA5F,SAAAyF,EAAAzI,OAAA,UAAF,gBAAA+I,EAAAC,GAAA,OAAAT,EAAAzL,MAAAkD,KAAAkD,YAAA,GAUNkE,KAAI,eAAA6B,EAAAT,EAAAlI,mBAAAC,KAAE,SAAA2I,EAAOR,GAAP,OAAApI,mBAAAa,KAAA,SAAAgI,GAAA,cAAAA,EAAA9H,KAAA8H,EAAAhJ,MAAA,OACFiI,EAAKhB,OACLsB,MAFE,wBAAAS,EAAAnG,SAAAkG,EAAAlJ,SAAF,gBAAAoJ,GAAA,OAAAH,EAAAnM,MAAAkD,KAAAkD,YAAA,GAIJmG,MAAK,eAAAC,EAAAd,EAAAlI,mBAAAC,KAAE,SAAAgJ,EAAAnJ,EAAqBsI,GAArB,IAAAC,EAAA,OAAArI,mBAAAa,KAAA,SAAAqI,GAAA,cAAAA,EAAAnI,KAAAmI,EAAArJ,MAAA,cAASwI,EAATvI,EAASuI,SAATa,EAAArJ,KAAA,EACGiI,EAAKN,eAAea,GADvB,OAEHD,MAFG,wBAAAc,EAAAxG,SAAAuG,EAAAvJ,SAAF,gBAAAyJ,EAAAC,GAAA,OAAAJ,EAAAxM,MAAAkD,KAAAkD,YAAA,GAILyG,WAAU,eAAAC,EAAApB,EAAAlI,mBAAAC,KAAE,SAAAsJ,EAAOnB,GAAP,OAAApI,mBAAAa,KAAA,SAAA2I,GAAA,cAAAA,EAAAzI,KAAAyI,EAAA3J,MAAA,OACRuI,EAAKN,EAAKlI,OAAO8G,UADT,wBAAA8C,EAAA9G,SAAA6G,EAAA7J,SAAF,gBAAA+J,GAAA,OAAAH,EAAA9M,MAAAkD,KAAAkD,YAAA,GAGV8G,MAAK,eAAAC,EAAAzB,EAAAlI,mBAAAC,KAAE,SAAA2J,EAAOxB,GAAP,OAAApI,mBAAAa,KAAA,SAAAgJ,GAAA,cAAAA,EAAA9I,KAAA8I,EAAAhK,MAAA,cAAAgK,EAAAhK,KAAA,EACG4F,EAAA,EAAMqE,OADT,cAAAD,EAAAhK,KAAA,EAEG4F,EAAA,EAAMsE,SAAS,YAAYC,QAF9B,cAAAH,EAAAhK,KAAA,EAGG4F,EAAA,EAAMsE,SAAS,gBAAgBC,QAHlC,cAAAH,EAAAhK,KAAA,EAIG4F,EAAA,EAAMsE,SAAS,YAAYC,QAJ9B,cAAAH,EAAAhK,KAAA,GAKG4F,EAAA,EAAMsE,SAAS,QAAQC,QAL1B,QAMH5B,IANG,yBAAAyB,EAAAnH,SAAAkH,EAAAlK,SAAF,gBAAAuK,GAAA,OAAAN,EAAAnN,MAAAkD,KAAAkD,YAAA,GAQLsH,oBAAmB,eAAAC,EAAAjC,EAAAlI,mBAAAC,KAAE,SAAAmK,EAAOhC,GAAP,IAAA7F,EAAA,OAAAvC,mBAAAa,KAAA,SAAAwJ,GAAA,cAAAA,EAAAtJ,KAAAsJ,EAAAxK,MAAA,cAAAwK,EAAAxK,KAAA,EACIiI,EAAKlI,OAAO0D,YAAYC,aAD5B,OACXhB,EADW8H,EAAA7I,KAEjB4G,GACIkC,YAAa/H,EAAOW,WACpB7D,QAASyI,EAAKlI,OAAO2K,iBAJR,wBAAAF,EAAA3H,SAAA0H,EAAA1K,SAAF,gBAAA8K,GAAA,OAAAL,EAAA3N,MAAAkD,KAAAkD,YAAA,GAOnBmE,YAAW,eAAA0D,EAAAvC,EAAAlI,mBAAAC,KAAE,SAAAyK,EAAOtC,GAAP,IAAApB,EAAA2D,EAAAC,EAAAC,EAAAC,EAAAC,EAAA3K,EAAA,OAAAJ,mBAAAa,KAAA,SAAAmK,GAAA,cAAAA,EAAAjK,KAAAiK,EAAAnL,MAAA,cACTiI,EAAKP,eADIyD,EAAAnL,KAAA,EAEciI,EAAKlI,OAAOwD,eAAe2D,cAFzC,OAGT,IADMC,EAFGgE,EAAAxJ,KAAAmJ,GAAA,EAAAC,GAAA,EAAAC,OAAA9E,EAAAiF,EAAAjK,KAAA,EAGT+J,EAAoB9D,EAApB/I,OAAAiI,cAAAyE,GAAAI,EAAAD,EAAAjL,QAAAsG,MAAAwE,GAAA,EAASvK,EAAqB2K,EAAA5M,MAC1B2J,EAAKV,aAAahH,GAJb4K,EAAAnL,KAAA,iBAAAmL,EAAAjK,KAAA,GAAAiK,EAAAzC,GAAAyC,EAAA,SAAAJ,GAAA,EAAAC,EAAAG,EAAAzC,GAAA,QAAAyC,EAAAjK,KAAA,GAAAiK,EAAAjK,KAAA,GAAA4J,GAAA,MAAAG,EAAAvE,QAAAuE,EAAAvE,SAAA,WAAAyE,EAAAjK,KAAA,IAAA6J,EAAA,CAAAI,EAAAnL,KAAA,eAAAgL,EAAA,eAAAG,EAAAC,OAAA,mBAAAD,EAAAC,OAAA,YAMT7C,EAAKpB,GANI,yBAAAgE,EAAAtI,SAAAgI,EAAAhL,OAAA,6BAAF,gBAAAwL,GAAA,OAAAT,EAAAjO,MAAAkD,KAAAkD,YAAA,GAQXuI,cAAa,eAAAC,EAAAlD,EAAAlI,mBAAAC,KAAE,SAAAoL,EAAAvI,EAAoBsF,GAApB,IAAA/I,EAAAe,EAAA,OAAAJ,mBAAAa,KAAA,SAAAyK,GAAA,cAAAA,EAAAvK,KAAAuK,EAAAzL,MAAA,cAASR,EAATyD,EAASzD,QACpByI,EAAKP,eADM+D,EAAAzL,KAAA,EAGWiI,EAAKlI,OAAOwD,eAAe+H,cAAc9L,GAHpD,OAGLe,EAHKkL,EAAA9J,KAIXsG,EAAKV,aAAahH,GAClBgI,EAAKhI,EAAQ/E,KAAK2F,MALP,wBAAAsK,EAAA5I,SAAA2I,EAAA3L,SAAF,gBAAA6L,EAAAC,GAAA,OAAAJ,EAAA5O,MAAAkD,KAAAkD,YAAA,GAOb6I,cAAa,eAAAC,EAAAxD,EAAAlI,mBAAAC,KAAE,SAAA0L,EAAA1I,EAAgCmF,GAAhC,IAAAwD,EAAAvM,EAAAwM,EAAAtL,EAAAH,EAAA,OAAAJ,mBAAAa,KAAA,SAAAiL,GAAA,cAAAA,EAAA/K,KAAA+K,EAAAjM,MAAA,cAAS+L,EAAT3I,EAAS2I,WAAYvM,EAArB4D,EAAqB5D,QAChCyI,EAAKP,eACCsE,EAAW7P,OAAA+P,EAAA,uBAAA/P,CAAuB4P,GAClCrL,EAAUsL,EAAStL,QAHduL,EAAA/K,KAAA,EAAA+K,EAAAjM,KAAA,EAKeiI,EAAKlI,OAAOwD,eAAe4I,YAAazL,UAASlB,YALhE,cAKDe,EALC0L,EAAAtK,KAMPL,QAAQC,IAAI,gBAAiBhB,EAASwL,GAN/BE,EAAAjM,KAAA,GAODiI,EAAKlI,OAAO4G,WAAWyF,WACzB7L,QAASA,EACTwL,WAAYA,IATT,QAWP9D,EAAKV,aAAahH,GAClBgI,EAAKhI,EAAQ/E,KAAK2F,MAZX8K,EAAAjM,KAAA,iBAAAiM,EAAA/K,KAAA,GAAA+K,EAAAvD,GAAAuD,EAAA,SAcP3K,QAAQqH,MAARsD,EAAAvD,IACAH,GAAOI,MAAO,6BAAAsD,EAAAvD,KAfP,yBAAAuD,EAAApJ,SAAAiJ,EAAAjM,OAAA,WAAF,gBAAAwM,EAAAC,GAAA,OAAAT,EAAAlP,MAAAkD,KAAAkD,YAAA,GAkBbwJ,cAAa,eAAAC,EAAAnE,EAAAlI,mBAAAC,KAAE,SAAAqM,EAAAC,EAAyBnE,GAAzB,IAAAtD,EAAAuD,EAAAjI,EAAAwL,EAAAY,EAAA,OAAAxM,mBAAAa,KAAA,SAAA4L,GAAA,cAAAA,EAAA1L,KAAA0L,EAAA5M,MAAA,cAASiF,EAATyH,EAASzH,GAAIuD,EAAbkE,EAAalE,SACxBP,EAAKP,eADMkF,EAAA5M,KAAA,EAEWiI,EAAKrC,MAAMuB,SAASjJ,IAAI+G,GAFnC,cAEL1E,EAFKqM,EAAAjL,KAAAiL,EAAA1L,KAAA,EAAA0L,EAAA5M,KAAA,EAKY7D,OAAA+P,EAAA,kBAAA/P,CAAkBoE,EAAQ/E,KAAKuQ,WAAY9D,EAAK4E,gBAL5D,OAKPd,EALOa,EAAAjL,KAAAiL,EAAA5M,KAAA,wBAAA4M,EAAA1L,KAAA,GAAA0L,EAAAlE,GAAAkE,EAAA,SAOPtL,QAAQqH,MAARiE,EAAAlE,IACAH,GAAOI,MAAO,kCAAAiE,EAAAlE,KARPkE,EAAAxL,OAAA,yBAAAwL,EAAA5M,KAAA,GAWoB7D,OAAA+P,EAAA,kBAAA/P,CAAkB4P,EAAYvD,GAXlD,QAWLmE,EAXKC,EAAAjL,KAYX4G,GAAMwD,WAAY5P,OAAA+P,EAAA,iBAAA/P,CAAiBwQ,KAZxB,yBAAAC,EAAA/J,SAAA4J,EAAA5M,OAAA,WAAF,gBAAAiN,EAAAC,GAAA,OAAAP,EAAA7P,MAAAkD,KAAAkD,YAAA,GAcbiK,gBAAe,eAAAC,EAAA5E,EAAAlI,mBAAAC,KAAE,SAAA8M,EAAOlL,EAAIxC,EAAS+I,GAApB,IAAA4E,EAAA,OAAAhN,mBAAAa,KAAA,SAAAoM,GAAA,cAAAA,EAAAlM,KAAAkM,EAAApN,MAAA,cACbiI,EAAKP,eADQ0F,EAAAlM,KAAA,EAAAkM,EAAApN,KAAA,EAGeiI,EAAKlI,OAAOiN,iBAChCtM,QAASsB,EAAGG,KACZ3C,QAASA,GACVwC,GANM,OAGHmL,EAHGC,EAAAzL,KAOTL,QAAQC,IAAI4L,EAAWA,EAAUE,YAAYC,QAC7C/E,GAAOvG,GAAImL,EAAUE,YAAYC,SARxBF,EAAApN,KAAA,gBAAAoN,EAAAlM,KAAA,EAAAkM,EAAA1E,GAAA0E,EAAA,SAUT9L,QAAQqH,MAARyE,EAAA1E,IACAH,GAAOI,MAAOyE,EAAA1E,GAAE6E,SAAW,GAAAH,EAAA1E,KAXlB,yBAAA0E,EAAAvK,SAAAqK,EAAArN,OAAA,UAAF,gBAAA2N,EAAAC,EAAAC,GAAA,OAAAT,EAAAtQ,MAAAkD,KAAAkD,YAAA,GAcf4K,aAAY,eAAAC,EAAAvF,EAAAlI,mBAAAC,KAAE,SAAAyN,EAAO1K,EAAaoF,GAApB,IAAAuF,EAAA,OAAA3N,mBAAAa,KAAA,SAAA+M,GAAA,cAAAA,EAAA7M,KAAA6M,EAAA/N,MAAA,UACVsB,QAAQC,IAAI,eAAgB4B,GACvBA,EAAYzC,QAFP,CAAAqN,EAAA/N,KAAA,eAAA+N,EAAA3M,OAAA,SAEuBmH,OAFvB,cAAAwF,EAAA/N,KAAA,EAGQiI,EAAKlI,OAAOgH,mBAAmBiH,uBAAuB7K,GAH9D,QAGJ2K,EAHIC,EAAApM,MAINsM,KAAK,SAAC9I,EAAG+I,GAAJ,OAAW/I,EAAE3J,KAAK8G,GAAK4L,EAAE1S,KAAK8G,GAAK,EAAK6C,EAAE3J,KAAK8G,IAAM4L,EAAE1S,KAAK8G,GAAK,GAAK,IAC/EiG,EAAKuF,GALK,wBAAAC,EAAAlL,SAAAgL,EAAAhO,SAAF,gBAAAsO,EAAAC,GAAA,OAAAR,EAAAjR,MAAAkD,KAAAkD,YAAA,GAOZsL,iBAAgB,eAAAC,EAAAjG,EAAAlI,mBAAAC,KAAE,SAAAmO,EAAOpL,EAAaoF,GAApB,IAAAhI,EAAA,OAAAJ,mBAAAa,KAAA,SAAAwN,GAAA,cAAAA,EAAAtN,KAAAsN,EAAAxO,MAAA,UACTmD,EAAYzC,QADH,CAAA8N,EAAAxO,KAAA,eAAAwO,EAAApN,OAAA,SACmBmH,OADnB,cAAAiG,EAAAxO,KAAA,EAEQiI,EAAKlI,OAAOgH,mBAAmB0H,mBAAmBtL,GAF1D,OAER5C,EAFQiO,EAAA7M,KAGdsG,EAAKV,aAAahH,EAASgI,GAHb,wBAAAiG,EAAA3L,SAAA0L,EAAA1O,SAAF,gBAAA6O,EAAAC,GAAA,OAAAL,EAAA3R,MAAAkD,KAAAkD,YAAA,KAYpB6L,IACI5G,EACAE,EACAF,EACA,SAACvB,GACOA,GAAKlF,IAAIoH,MAAMlC,KAG3ByB,EAAMtB,GAAG,SAAU,SAACiI,GAChB,IAAMC,EAAaD,EAAOC,WAAWjQ,KAAKgQ,GAC1C5G,EAAKrB,GAAG,SAAUkI,KAMtBjP,KAAKkE,MAAM6C,GAAG,SAAU,SAAC7C,GACrBkE,EAAKtD,KAAK,UAAYZ,4XC1PlC,SAAA1D,IAAA,IAAA0O,EAIaC,EAJb,OAAA7O,mBAAAa,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAjB,MAAA,OAIagP,EAJb,SAI4BC,GACpB,IAAMC,EAAcD,EAAWpR,KAC/ByD,QAAQC,IAAI,+BAAgC2N,GAE5CH,EAAWhL,MAAMM,IAAI,UAErB,IAAM8K,EAAa,IAAIC,EAAAjK,EAAW8J,GAClCF,EAAWM,mBAAmBF,GAE9BJ,EAAW1J,QAAQC,WAAY,EAC/BgK,IAAYH,EAAY,WACpBJ,EAAW1J,QAAQC,WAAY,EAC/BhE,QAAQC,IAAI,yBAA0B2N,GACtCH,EAAWhL,MAAMM,IAAI,eAhBvB0K,EAAa,IAAInK,EACvBM,EAAAC,EAAUC,QAAQmK,UAAUC,YAAYR,GAF5C,wBAAA/N,EAAA4B,SAAAxC,EAAAR,gCAdA1C,EAAQ,KAQRmE,QAAQC,IAAI,kCACZD,QAAQC,IAAI,eAAgB2D,EAAAC,EAAUC,QAAQH,uCAG9CwK,GA4CAC,OAAOC,aAAaC,YACpBF,OAAOC,aAAahR,QAChBkR,MAAO,iBACPC,UAAW,kBACXC,QAAS,WACL7K,EAAAC,EAAU6K,KAAKrR,QAAQmC,IAAM,gBAIrCoE,EAAAC,EAAU6K,KAAKrR,QAAQmC,IAAM","file":"background.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([311,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = __webpack_public_path__ + \"manifest.json\";","export default {\n    chains: [\n        {\n            chainId: 'testnet.aergo.io',\n            nodeUrl: 'http://testnet.aergo.io:7845'\n        },\n        {\n            chainId: 'dev.chain',\n            nodeUrl: 'http://127.0.0.1:7845'\n        }\n    ]\n};","import { Address } from '@herajs/client';\nimport { Transaction } from '@herajs/wallet';\n\n/**\n * This is a data source for transactionManager.getAccountTransactions.\n * It uses the Aergoscan API which is experimental and subject to change.\n * It is not recommended to use this data source.\n */\nexport class AergoscanTransactionScanner {\n    fetchAccountTransactionsAfter(wallet) {\n        return (next) => async ({ account, blockno, limit }) => {\n            const chainId = account.data.spec.chainId\n            if (chainId !== 'testnet.aergo.io') {\n                return next({ account, blockno, limit });\n            }\n            const address = new Address(account.data.spec.address);\n            console.log(`[track account] Fetching txs for ${address} on ${chainId} since ${blockno}...`);\n            const q = encodeURIComponent(`(from:${address} OR to:${address}) AND blockno:>${blockno}`);\n            const baseUrl = 'https://api.aergoscan.io/testnet';\n            const size = 1000;\n            const offset = 0;\n            const url = `${baseUrl}/transactions?q=${q}&sort=blockno:desc&size=${size}&from=${offset}`;\n            const response = await fetch(url);\n            const data = await response.json();\n            console.log(`[track account] Got ${data.hits.length} (of ${data.total}) txs for ${address} since ${blockno}.`);\n            return data.hits.map(tx => new Transaction(tx.hash, {\n                chainId,\n                from: tx.meta.from,\n                to: tx.meta.to,\n                hash: tx.hash,\n                ts: tx.meta.ts,\n                blockhash: '', // TODO: remove or add?\n                blockno: tx.meta.blockno,\n                amount: tx.meta.amount,\n                type: tx.meta.type,\n                status: Transaction.Status.Confirmed\n            }));\n        };\n    }\n\n    fetchAccountTransactions(wallet) {\n        return () => async (account) => {\n            const accountSpec = wallet.accountManager.getCompleteAccountSpec(account.data.spec);\n            const { bestHeight } = await wallet.getClient(accountSpec.chainId).blockchain();\n            return this.fetchAccountTransactionsBefore(wallet)(async () => [])({ account, blockno: bestHeight });\n        };\n    }\n}","import {EventEmitter} from 'events';\n\nconst IDLE_TIMEOUT = 60 * 1000;\n\nclass State extends EventEmitter {\n    constructor() {\n        super();\n        this._idleTimeout = null;\n        this.set('initial');\n    }\n\n    /**\n     * App states: initial -> active -> inactive -> idle\n     * Opening UI switches state to active. Closing UI switches state to inactive.\n     * After being inactive for a certain amount of time, switch to idle.\n     * @param {string} nextState \n     */\n    set(nextState) {\n        if (nextState != 'inactive') {\n            if (this._idleTimeout) {\n                clearTimeout(this._idleTimeout);\n            }\n        }\n        if (this.state != nextState && nextState == 'inactive') {\n            if (this._idleTimeout) {\n                clearTimeout(this._idleTimeout);\n            }\n            this._idleTimeout = setTimeout(() => {\n                this.set('idle');\n            }, IDLE_TIMEOUT);\n        }\n        if (this.state != nextState) {\n            console.log(`[state] ${this.state} -> ${nextState}`);\n        }\n        this.state = nextState;\n        this.emit('change', nextState);\n        this.emit(nextState);\n    }\n}\n\nexport default State;","import extension from 'extensionizer';\nimport { EventEmitter } from 'events';\nimport pump from 'pump';\nimport Dnode from 'dnode/browser.js';\n\nimport { Wallet } from '@herajs/wallet';\nimport config from './config';\nimport store from './store';\nimport { AergoscanTransactionScanner } from './tx-scanner';\n\nimport {\n    identifyFromPrivateKey,\n    decryptPrivateKey, encryptPrivateKey,\n    encodePrivateKey\n} from '@herajs/crypto';\nimport State from './state';\nimport 'whatwg-fetch';\n\nimport bs58 from 'bs58';\nimport { Buffer } from 'buffer';\n\nexport function encodeTxHash(bytes) {\n    return bs58.encode(Buffer.from(bytes));\n}\n\nexport function decodeTxHash(bs58string) {\n    return bs58.decode(bs58string);\n}\n\nconst AUTO_LOCK_TIMEOUT = 60*1000;\n\nclass BackgroundController extends EventEmitter {\n    constructor() {\n        super();\n\n        this.id = extension.runtime.id;\n\n        this.uiState = {\n            popupOpen: false\n        }\n        this.state = new State();\n        this._lockTimeout = null;\n        \n\n        this.wallet = new Wallet({\n            appName: 'aergo-browser-wallet',\n            instanceId: this.id\n        });\n        this.wallet.use(AergoscanTransactionScanner);\n        this.wallet.useStorage(store).then(() => {\n            this.firstLoad();\n        });\n        for (let chain of config.chains) {\n            this.wallet.useChain(chain);\n        }\n\n        this.wallet.keyManager.on('lock', () => {\n            this.emit('update', { unlocked: false });\n            console.log('[lock] locked');\n        });\n        this.wallet.keyManager.on('unlock', () => {\n            this.emit('update', { unlocked: true });\n            console.log('[lock] unlocked');\n        });\n\n        this.state.on('idle', () => {\n            console.log('[state] idle, pausing trackers');\n            this.wallet.accountManager.pause();\n            this.wallet.transactionManager.pause();\n        });\n        this.state.on('active', () => {\n            console.log('[state] active, resuming trackers');\n            this.wallet.accountManager.resume();\n            this.wallet.transactionManager.resume();\n        });\n\n        this.lock();\n    }\n\n    async firstLoad() {\n        const accounts = await this.wallet.accountManager.getAccounts();\n        for (let account of accounts) {\n            this.trackAccount(account);\n        }\n    }\n\n    lock () {\n        this.wallet.lock();\n    }\n    \n    async unlock (passphrase) {\n        await this.wallet.unlock(passphrase);\n        this.keepUnlocked();\n    }\n\n    async setupAndUnlock (passphrase) {\n        await this.wallet.setupAndUnlock(passphrase);\n        this.keepUnlocked();\n    }\n\n    keepUnlocked() {\n        if (this._lockTimeout) {\n            clearTimeout(this._lockTimeout);\n        }\n        this._lockTimeout = setTimeout(() => {\n            console.log('[lock] auto-locking...');\n            this.lock();\n        }, AUTO_LOCK_TIMEOUT);\n    }\n\n    isUiOpen() {\n        return this.uiState.popupOpen;\n    }\n\n    trackAccount(account, onceCb) {\n        const accountTracker = this.wallet.accountManager.trackAccount(account);\n        this.wallet.transactionManager.trackAccount(account);\n        accountTracker.then(t => {\n            t.removeAllListeners('update');\n            t.on('update', account => {\n                console.log('got new state', account);\n                this.emit('update', { accounts: [account] });\n                if (onceCb) {\n                    onceCb(account);\n                    onceCb = false;\n                }\n            });\n        });\n    }\n\n    setupCommunication (outStream) {\n        // Setup async rpc stream to UI\n        const dnode = Dnode({\n            unlock: async ({ password }, send) => {\n                try {\n                    await this.unlock(password);\n                } catch (e) {\n                    console.error(e);\n                    send({ error: ''+e });\n                    return;\n                }\n                send({});\n            },\n            lock: async (send) => {\n                this.lock();\n                send({});\n            },\n            setup: async ({ password }, send) => {\n                await this.setupAndUnlock(password);\n                send({});\n            },\n            isUnlocked: async (send) => {\n                send(this.wallet.unlocked);\n            },\n            reset: async (send) => {\n                await store.open();\n                await store.getIndex('accounts').clear();\n                await store.getIndex('transactions').clear();\n                await store.getIndex('settings').clear();\n                await store.getIndex('keys').clear();\n                send();\n            },\n            getBlockchainStatus: async (send) => {\n                const status = await this.wallet.getClient().blockchain();\n                send({\n                    blockHeight: status.bestHeight,\n                    chainId: this.wallet.defaultChainId\n                });\n            },\n            getAccounts: async (send) => {\n                this.keepUnlocked();\n                const accounts = await this.wallet.accountManager.getAccounts();\n                for (let account of accounts) {\n                    this.trackAccount(account);\n                }\n                send(accounts);\n            },\n            createAccount: async ({ chainId }, send) => {\n                this.keepUnlocked();\n                \n                const account = await this.wallet.accountManager.createAccount(chainId);\n                this.trackAccount(account);\n                send(account.data.spec);\n            },\n            importAccount: async ({ privateKey, chainId }, send) => {\n                this.keepUnlocked();\n                const identity = identifyFromPrivateKey(privateKey);\n                const address = identity.address;\n                try {\n                    const account = await this.wallet.accountManager.addAccount({ address, chainId });\n                    console.log('importAccount', account, privateKey);\n                    await this.wallet.keyManager.importKey({\n                        account: account,\n                        privateKey: privateKey\n                    });\n                    this.trackAccount(account);\n                    send(account.data.spec);\n                } catch(e) {\n                    console.error(e);\n                    send({ error: 'Could not import account. '+e });\n                }\n            },\n            exportAccount: async ({ id, password }, send) => {\n                this.keepUnlocked();\n                const account = await this.store.accounts.get(id);\n                let privateKey;\n                try {\n                    privateKey = await decryptPrivateKey(account.data.privateKey, this.masterPassword);\n                } catch (e) {\n                    console.error(e);\n                    send({ error: 'Could not decrypt private key. '+e });\n                    return;\n                }\n                const privkeyEncrypted = await encryptPrivateKey(privateKey, password);\n                send({privateKey: encodePrivateKey(privkeyEncrypted)});\n            },\n            sendTransaction: async (tx, chainId, send) => {\n                this.keepUnlocked();\n                try {\n                    const txTracker = await this.wallet.sendTransaction({\n                        address: tx.from,\n                        chainId: chainId\n                    }, tx);\n                    console.log(txTracker, txTracker.transaction.txBody);\n                    send({ tx: txTracker.transaction.txBody });\n                } catch(e) {\n                    console.error(e);\n                    send({ error: e.message || ''+e });\n                }\n            },\n            getAccountTx: async (accountSpec, send) => {\n                console.log('getAccountTx', accountSpec);\n                if (!accountSpec.address) return send({});\n                const txs = await this.wallet.transactionManager.getAccountTransactions(accountSpec);\n                txs.sort((a, b) => (a.data.ts < b.data.ts ? 1 : (a.data.ts == b.data.ts ? 0 : -1)));\n                send(txs);\n            },\n            syncAccountState: async (accountSpec, send) => {\n                if (!accountSpec.address) return send({});\n                const account = await this.wallet.transactionManager.getOrCreateAccount(accountSpec);\n                this.trackAccount(account, send);\n                /*const tracker = await this.wallet.accountManager.trackAccount(accountSpec);\n                tracker.once('update', account => {\n                    console.log('got new state', account);\n                    tracker.pause();\n                    send(account);\n                });*/\n            }\n        })\n        pump(\n            outStream,\n            dnode,\n            outStream,\n            (err) => {\n                if (err) log.error(err);\n            }\n        );\n        dnode.on('remote', (remote) => {\n            const sendUpdate = remote.sendUpdate.bind(remote);\n            this.on('update', sendUpdate)\n        });\n\n        /*setInterval(() => {\n            this.emit('update', 'something');\n        }, 1000)*/\n        this.state.on('change', (state) => {\n            this.emit('update', { state });\n        });\n    }\n}\n\nexport default BackgroundController;","import \"regenerator-runtime/runtime\";\n\nrequire('./manifest.json');\n\nimport extension from 'extensionizer';\nimport endOfStream from 'end-of-stream';\nimport PortStream from 'extension-port-stream';\n\nimport BackgroundController from './controllers/background';\n\nconsole.log('AERGO Wallet Background Script');\nconsole.log('Extension ID', extension.runtime.id);\n\n\nsetupController();\n\nasync function setupController() {\n    const controller = new BackgroundController();\n    extension.runtime.onConnect.addListener(connectRemote);\n    \n    function connectRemote (remotePort) {\n        const processName = remotePort.name;\n        console.log('Establishing connection with', processName);\n\n        controller.state.set('active');\n    \n        const portStream = new PortStream(remotePort);\n        controller.setupCommunication(portStream);\n    \n        controller.uiState.popupOpen = true;\n        endOfStream(portStream, () => {\n            controller.uiState.popupOpen = false;\n            console.log('Closed connection with', processName);\n            controller.state.set('inactive');\n        })\n\n        /*\n\n        const notifId = '';\n        extension.notifications.create(\n            notifId,\n            {\n                type: 'basic',\n                title: 'Aergo Wallet',\n                iconUrl: extension.extension.getURL('0da81dee4755822e45e812c8ce30d733.png'),\n                message: `Hello from the Wallet! Established connection with ${processName}. Yes.`,\n            }\n        );\n        extension.notifications.onClicked.addListener((url) => {\n            if (!txId.startsWith('http')) return;\n            console.log('clicked on', e);\n            extension.tabs.create({ url });\n        });\n\n        */\n    }\n}\n\nchrome.contextMenus.removeAll();\nchrome.contextMenus.create({\n    title: \"Open full page\",\n    contexts: [\"browser_action\"],\n    onclick: function() {\n        extension.tabs.create({url : \"tab.html\"});\n    }\n});\n\nextension.tabs.create({url : \"tab.html\"});\n\n"],"sourceRoot":""}